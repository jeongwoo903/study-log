# [JS] 다시 한 번 JS: 클로저

## 클로저의 의미

클로저의 영어 사전적 의미는 **닫힘, 폐쇄, 완결성** 이다.  

MDN에서의 클로저의 사전적의미는 다음과 같이 나와있다.

> 클로저는 주변 상태(Lexical Environment)에 대한 참조와 함께 묶인(포함된) 함수의 조합이다.
> 즉, 클로저는 내부 함수에서 외부 함수의 범위에 대한 접근을 제공합니다.  

> 외부 함수보다 중첩 함수가 더 오래 유지되는 경우, 중첩 함수는 이미 생명 주기가 종료한 외부 함수의 변수를 참조할 수 있다. 이러한 중첩 함수를 **클로저(closer)** 하고 한다.

클로저는 함수가 생성되면 당연히 만들어 진다.
하지만 우리는 클로저가 생김으로 인해서 생기는 **특별한 현상**에 대해 알아봐야 한다.

| ![01.png](assets/%5BJS%5D%20%EB%8B%A4%EC%8B%9C%20%ED%95%9C%20%EB%B2%88%20JS%3A%20%ED%81%B4%EB%A1%9C%EC%A0%80/01.png) |
|:--------------------------------------------------------------------------------------------------------------------:|
|                                                  클로저와 실행 컨텍스트와의 관계                                                   |

> 실행 컨텍스트 A에 내부함수 B가 선언 되었을때, B의 outerEnvironmentReference는 A의 environmentRecord를 참조할 수 있다.  

**특별한 현상**에 대해서 알아보자.
```js
var outer = function() {
  var a = 1;
  var inner = function() {
    return ++a;
  }
  return inner;
}

var outer2 = outer();
console.log(outer2()); // 2
```

해당 함수를 하나씩 따라가보자.

1. 전역 컨텍스트가 만들어진다.
2. 호이스팅이 발생하면 선언된 outer와 outer2가 environmentRecord에 기록된다.
3. outer2는 outer 함수의 실행이 종료된 시점이 되어야 어떤 값이 담긴다.

1. outer 컨텍스트가 만들어진다.
2. outer 컨텍스트의 environmentRecord에는 { a: 1, inner: f }가 담기게 된다.
3. outer 컨텍스트의 outerEnvironmentReference에는 { outer: f }가 담기게 된다.
4. inner가 반환되면서 전역 컨텍스트의 outer2에는 inner가 담기게 된다.

이때, outer2에 의해서 inner 함수가 다시 실행될 수 있으니까 outer 컨텍스트의 environmentRecord에 있던 a의 값은 살아있게 된다.

> 왜 a가 살았냐?  
> inner 함수 내에는 a가 없기 때문에 scopeChain에 의해서 상위 컨텍스트의 값을 참조하게 되었기 때문이다.

이 상태에서 console.log(outer2());가 이뤄지면,
1. inner 컨텍스트가 만들어진다.
2. inner 컨텍스트의 environmentRecord에는 a가 없기 때문에 outerEnvironmentReference를 이용해 outer 컨텍스트의 environmentRecord를 살펴본다.
3. outer 컨텍스트의 environmentRecord에는 참조로 인해 남아있는 a = 1;이 있기 때문에 이 값을 참조한다.
4. ++a가 이뤄져 2가 반환된다.

이처럼 마치 변수 a가 좀비처럼 살아있는 현상이 발생하게 된다.
위에서 말한 **특별한 현상**은 이를 가리킨다.

정리해보자면, **컨텍스트 A에서 선언한 변수 a**를 참조하는 **내부함수 B**를 **A의 외부로 전달**할 경우, **A가 종료된 이후에도 a가 사라지지 않는 현상.**

이 말은 **클로저를 이용하면 지역변수가 함수 종료 후에도 사라지지 않게 할 수 있다는 말이다.**  
할 수 있다는 말은 해도 되고 안해도 된다는 말이니까 즉, 사용자가 특정 지역변수를 살리고 없애고 할 수 있다는 말이다.

## 정리

클로저는 함수와 함수를 둘러싼 컨텍스트 환경을 의미한다.  
다만, 우리는 클로저의 현상 중에서 함수 내부에서 외부 함수를 참조 했을때, 외부 함수가 종료 되었음에도 외부 함수에 참조가 가능한 현상을 중요시 한다.