# [Network] 네트워크 기초
| ![01.png](assets/%5BNetwork%5D%20%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC%20%EA%B8%B0%EC%B4%88/01.png) |
|:--------------------------------------------------------------------------------------------------:|
|                                       인터넷 네트워크를 도식적으로 표현한 그림                                       |

인터넷 네트워크의 노드는 최초에 4개에서 부터 시작했다.
현재는 엄청나게 많아졌다.

위의 그림은 인터넷의 주요 서비스 제공자를 도식화 한 것이다.

위의 그림에서 우리(User)는 가장자리(Edge)에 위치하게 된다.
서버도 매한가지로 가장자리에 위치한다.

## 네트워크 엣지
인터넷의 가장자리를 차지하는 End System은 네트워크에 접속된 장비를 말한다.

End System은 웹 브라우저나 이메일 같은 인터넷 응용 프로그램을 실행시킨다.  
End System은 응용 프로그램을 실행하기 때문에 호스트(host)라고 부르기도 한다.

### 데이터를 어떻게 전송할까?
우리는 여러 디바이스 끼리 데이터를 주고 받는다.
우리는 네트워크 관점에서 보면 위에서 말했듯이 네트워크 엣지 부분에 위치하게 되는데, 어떻게 네트워크 엣지에서 데이터를 전송할까?

## TCP와 UDP
데이터를 전송하는 대표적인 방법으로 TCP와 UDP가 있다.

### TCP(Transmission Control Protocol)
TCP는 다음과 같은 특성을 띈다.
1. Reliable
   - 데이터를 신뢰성 있게 받을 수 있다.
   - 대신, 수신 속도보다 전송 속도가 더 빠를 수 없다.
   - 위를 제어하기 위해서 네트워크 자원이 더 사용된다.
2. In Order
   - 데이터 순서가 바뀌지 않고 순차적으로 받을 수 있다.

### UDP
1. UnReliable
   - 데이터 신뢰성이 낮다.
   - 대신, 네트워크 자원이 덜 사용된다.
2. No Order
   - 데이터가 순서대로 전송되지 않는다.

## 프로토콜
TCP와 UDP 둘 다 Protocol 이라는 단어가 사용된다.

프로토콜은 **사람과 사람, 또는 기계와 기계 간의 약속**이다.

우리는 악수를 건네면 상대방도 손을 내민다. 이미 악수라는 행위에 대한 규칙을 알고있다.
통신에서도 데이터를 주고 받기 위해 여러 규칙이 있다. 이 중 일부가 TCP, UDP이다.

## 네트워크 코어
| ![02.png](assets/%5BNetwork%5D%20%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC%20%EA%B8%B0%EC%B4%88/02.png) |
|:--------------------------------------------------------------------------------------------------:|
|                                         붉게 표시된 것들이 라우터이다.                                          |

네트워크의 중심에는 수많은 라우터들이 연결되어있다.

## 네트워크 데이터 전달 방식
네트워크 내에서 데이터를 전달하는 방법에 대해서 알아보자.

### 회선 교환 (Circuit Switching) 방식
회선 교환 방식은 물리적인 전용 경로를 설정한 뒤 그 경로를 독점적으로 사용하여 데이터를 전송하는 방식이다.

### 패킷 교환 (Packet Switching) 방식
데이터를 패킷이라는 단위로 쪼개서, 각각의 패킷이 독립적으로 네트워크를 통과하는 방식이다.
인터넷에서는 패킷 교환 방식을 사용한다. 이유는 속도 때문이다.

| ![03.png](assets/%5BNetwork%5D%20%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC%20%EA%B8%B0%EC%B4%88/03.png) |
|:--------------------------------------------------------------------------------------------------:|

다음과 같은 상황을 가정해보자.
- 라우터에서는 1Mbps의 속도로 데이터를 전송한다.
- 유저는 활성화되어 있을 때, 100kb/s만큼의 자원을 이용한다.
- 각 유저는 전체 시간의 10%만큼 활성화되어 있다.

Q. 회선 교환 방식과 패킷 교환 방식 각각 몇 명 만큼의 유저가 이 네트워크를 사용할 수 있을까?
> 회선 교환 방식 수용가능 유저 수 = Capacity / bandwidth

A1. 회선 교환 방식: 10 users (1Mbps / 100kbps = 10) 
A2. 서킷 교환 방식: 동시에만 사용하지 않으면 무한대로 받을 수 있음. 

## 패킷
패킷은 비트들이 프로토콜 형식에 맞춰 모여진 정보의 덩어리 이다.
패킷에는 헤더, 페이로드, 트레일러 등의 정보가 포함된다.

## 패킷 전송에서의 시간 지연
| ![04.png](assets/%5BNetwork%5D%20%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC%20%EA%B8%B0%EC%B4%88/04.png) |
|:--------------------------------------------------------------------------------------------------:|

우리는 광속도로 데이터를 전송한다고 한다.

하지만 인터넷을 할때 로딩이나 데이터 지연이 생긴다 이는 왤까?

패킷 전송에서 시간 지연이 발생하는 원인은 네 가지가 있다.

### 1. Processing delay (처리 지연)
각 네트워크 노드에서 패킷을 수신하면 **제대로 전달 되었는지, 비트에 에러가 없는지 확인**한다.  
이와 같이 패킷 검사·처리 과정에서 발생하는 시간 지연을 Proccessing delay 라고 한다.  

### 2. Queueing delay (대기 지연)
패킷의 수신 속도보다 전송 속도가 빠르다면 노드는 이를 대기열에 넣고 큐 형식으로 관리하게 된다.  
이때 패킷이 대기열에서 머무는 시간을 Queueing delay 라고 한다.  

### 3. Transmission delay (전송 지연)
패킷의 모든 비트를 실제 링크(회선)으로 올리는데 걸리는 시간이다.  
전송 지연은 대체로 ‘패킷의 크기 / 전송 링크(대역폭)의 속도’로 계산할 수 있다.  

### 4. Propagation delay (전파 지연)
노드에서 다음 노드까지 전송되는데 걸리는 시간. 비트가 링크를 타고 이동하는데 걸리는 시간.

## 지연 시간을 줄이는 법
우리가 줄일 수 있는 지연시간은 정해져있다.

1. Processing delay (처리 지연)
   - 좋은 CPU나 라우터를 쓴다.
2. Transmission delay (전송 지연)
   - 링크 밴드의 폭을 늘리면됨


Propagation delay (전파 지연)는 전자기파의 속도에 따라 바뀌므로 절대 줄일 수 없다.

Queueing delay (대기 지연)는 데이터 전송량에 따라 달라지므로 해결할 수 없다.

Queueing delay는 얼마나 많은 데이터가 Queue에 저장되어 있는지에 따라 달라진다.
대기열이 짧으면 사람들이 대기하는 시간이 짧고 대기열이 길어지면 대기하는 시간이 길어진다.

이는 얼마나 많은 사람이 그걸 이용하려고 하는지에 따라서 달라진다.  
많은 사람들이 네트워크를 이용하고 있다면 queue에서 각 패킷이 대기해야 할 시간이 길어질 수 있다.

심지어 너무 많은 데이터를 수신하게 되면, queue의 용량은 무제한이 아니기 때문에 부족해질 수도 있다.  
queue가 가득차면 패킷 로스(Packet loss)가 일어날수도 있다.

## TCP 과정 톺아보기
TCP는 어떻게 데이터를 신뢰적으로 전송할까?  
TCP는 제대로 데이터가 목적지까지 도달하는지 지켜보고 있다가, 전송 도중 문제가 발생하게 되면 재전송을 한다.

다음과 같이 네트워크가 구성되어 있다 생각해보자.
```jsx
 A -> 라우터 1 -> 라우터 2 -> 라우터 3 -> B
```

만약 A에서 B로 데이터를 전송하다가 중간지점인 **라우터 2에서 패킷 로스가 발생했다** 하자.  

이때 TCP에 따르면 패킷 로스가 일어난 지점, 라우터 1부터 시작해서 라우터 2에 재전송을 시작하는 것이 아니라 **A에서 다시 재전송을 시작하게 된다.**  
그 이유는 Network Edge에서는 TCP를 쓰지만 Network Core에서는 TCP를 사용하지 않기 때문이다.

라우터에서 TCP를 이용하기엔 너무 많은 비용이 들고 라우터에서 데이터를 전송하는 것 만으로도 부하가 심하기 때문이다.  
라우터에서는 데이터 전송하는 역할 만을 하기 때문에 dumb core 라고도 불린다.